<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.highfives.grid.user.query.repository.UserMapper">

    <resultMap id="depInfo" type="org.highfives.grid.user.query.dto.LeaderInfoDTO">
        <id property="depName" column="department_name"/>
        <result property="depLeaderId" column="leader_id"/>
    </resultMap>

    <resultMap id="teamInfo" type="org.highfives.grid.user.query.dto.LeaderInfoDTO">
        <id property="teamName" column="team_name"/>
        <result property="teamLeaderId" column="leader_id"/>
    </resultMap>

    <resultMap id="depLeaderInfo" type="org.highfives.grid.user.query.dto.LeaderInfoDTO">
        <id property="depLeaderName" column="employee_name"/>
        <result property="depLeaderPosition" column="position_name"/>
    </resultMap>

    <resultMap id="teamLeaderInfo" type="org.highfives.grid.user.query.dto.LeaderInfoDTO">
        <id property="teamLeaderName" column="employee_name"/>
        <result property="teamLeaderPosition" column="duties_name"/>
    </resultMap>

    <resultMap id="userList" type="org.highfives.grid.user.query.dto.UserDTO">
        <id property="id" column="id"/>
        <result property="profilePath" column="path"/>
        <result property="name" column="employee_name"/>
        <result property="employeeNumber" column="employee_number"/>
        <result property="positionId" column="position_id"/>
        <result property="dutiesId" column="duties_id"/>
        <result property="phoneNumber" column="phone_number"/>
        <result property="absenceYn" column="absence_yn"/>
        <result property="absenceContent" column="absence_content"/>
        <result property="joinTime" column="join_time"/>
    </resultMap>

    <!-- 팀장/부서장 정보 불러오는 쿼리 -->
    <select id="getDepInfo" parameterType="_int" resultMap="depInfo">
        SELECT
        D.department_name,
        D.leader_id
        FROM department D
        JOIN employee E ON D.id = E.department_id
        WHERE E.id = #{id}
    </select>

    <select id="getTeamInfo" parameterType="_int" resultMap="teamInfo">
        SELECT
        T.team_name,
        T.leader_id
        FROM team T
        JOIN employee E ON T.id = E.team_id
        WHERE E.id = #{id}
    </select>

    <select id="getDepLeaderInfo" parameterType="_int" resultMap="depLeaderInfo">
        SELECT
        E.employee_name,
        P.position_name
        FROM Employee E
        JOIN E_Position P ON E.position_id = P.id
        WHERE E.id = #{id}
    </select>

    <select id="getTeamLeaderInfo" parameterType="_int" resultMap="teamLeaderInfo">
        SELECT
        E.employee_name,
        D.duties_name
        FROM Employee E
        JOIN Duties D ON E.duties_id = D.id
        WHERE E.id = #{id}
    </select>

    <!-- 전체 유저 리스트 조회 쿼리 -->
    <select id="getUserList" resultMap="userList">
        SELECT
        E.id,
        E.employee_name,
        E.employee_number,
        E.position_id,
        E.duties_id,
        E.phone_number,
        E.absence_yn,
        E.absence_content,
        E.join_time
        FROM Employee E
    </select>

<!--    <select id="selectPostsByCondition" parameterType="com.teamphoenix.ahub.fair.query.dto.FairDTO" resultMap="fairList">-->
<!--        SELECT-->
<!--        F.fair_id-->
<!--        , F.fair_title-->
<!--        , F.fair_content-->
<!--        , F.fair_writedate-->
<!--        , F.use_acceptance-->
<!--        , F.member_code-->
<!--        , F.fair_tag1-->
<!--        , F.fair_tag2-->
<!--        , F.fair_tag3-->
<!--        , F.fair_startdate-->
<!--        , F.fair_enddate-->
<!--        , F.fair_location-->
<!--        , F.fair_area-->
<!--        FROM fair F-->
<!--        <where>-->
<!--            <if test="fairTitle neq null and fairContent eq null">-->
<!--                F.fair_title LIKE CONCAT ('%', #{fairTitle}, '%')-->
<!--            </if>-->
<!--            <if test="fairContent neq null and fairTitle eq null">-->
<!--                F.fair_content LIKE CONCAT('%', #{fairContent}, '%')-->
<!--            </if>-->
<!--            <if test="fairTitle neq null and fairContent neq null">-->
<!--                F.fair_title LIKE CONCAT('%', #{fairTitle}, '%')-->
<!--                OR F.fair_content LIKE CONCAT('%', #{fairContent}, '%')-->
<!--            </if>-->
<!--            <if test="memberCode neq 0">-->
<!--                F.member_code = #{memberCode}-->
<!--            </if>-->
<!--        </where>-->
<!--    </select>-->
</mapper>